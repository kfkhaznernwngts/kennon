{{ define "main" }}
<article class="single-page">
  <h1>{{ .Title }}</h1>

  <div class="content">
    {{ .Content }}
  </div>

  <!-- ▼ モノクロ共有アイコンボタン ▼ -->
  <div class="share-section" style="margin:1.5em 0; text-align:right;">
    <button id="share-button"
      style="background:#f5f5f5; border:1px solid #ccc; border-radius:4px; padding:0.4em 0.6em; cursor:pointer; line-height:1; display:inline-flex; align-items:center; justify-content:center;">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    </button>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("share-button");
    const originalIcon = btn.innerHTML;
    btn.addEventListener("click", async () => {
      const url = window.location.href;
      const title = document.title;
      if (navigator.share) {
        try {
          await navigator.share({ title, url });
        } catch (e) {
          console.warn("共有がキャンセルされました");
        }
      } else {
        try {
          await navigator.clipboard.writeText(url);
          btn.innerHTML = "✔";
          btn.style.background = "#e6e6e6";
          setTimeout(() => {
            btn.innerHTML = originalIcon;
            btn.style.background = "#f5f5f5";
          }, 1500);
        } catch (e) {
          btn.innerHTML = "✖";
          btn.style.background = "#f5c6c6";
          setTimeout(() => {
            btn.innerHTML = originalIcon;
            btn.style.background = "#f5f5f5";
          }, 1500);
        }
      }
    });
  });
  </script>
  <!-- ▲ 共有ボタンここまで ▲ -->

  {{ partial "comments.html" . }}

  <nav class="post-pager">
    {{ $sections := site.Params.mainSections | default (slice "posts" "post") }}
    {{ $pages := where site.RegularPages "Section" "in" $sections }}
    {{ $pagesWithDate := slice }}
    {{ range $pages }}
      {{ $pubx := .PublishDate }}
      {{ if $pubx.IsZero }}
        {{ $m := site.Data.publishdates }}
        {{ $k1 := .File.Path }}
        {{ $k2 := printf "content/%s" .File.Path }}
        {{ $k3 := printf "content/%s%s" .File.Dir .File.LogicalName }}
        {{ with or (index $m $k1) (index $m $k2) (index $m $k3) }}
          {{ $pubx = time . }}
        {{ else }}
          {{ $pubx = .Date }}
        {{ end }}
      {{ end }}
      {{ $pagesWithDate = $pagesWithDate | append (dict "page" . "pub" $pubx) }}
    {{ end }}
    {{ $sorted := sort $pagesWithDate "pub" "desc" }}
    {{ $sortedPages := slice }}
    {{ range $sorted }}
      {{ $sortedPages = $sortedPages | append .page }}
    {{ end }}

    {{ $current := . }}
    {{ $index := -1 }}
    {{ range $i, $p := $sortedPages }}
      {{ if eq $p.File.Path $current.File.Path }}
        {{ $index = $i }}
      {{ end }}
    {{ end }}

    <div class="prev-post">
      {{ if ge (sub $index 1) 0 }}
        <a href="{{ (index $sortedPages (sub $index 1)).RelPermalink }}">←</a>
      {{ else }}
        <span class="placeholder"></span>
      {{ end }}
    </div>
    <div class="next-post">
      {{ if lt (add $index 1) (len $sortedPages) }}
        <a href="{{ (index $sortedPages (add $index 1)).RelPermalink }}">→</a>
      {{ else }}
        <span class="placeholder"></span>
      {{ end }}
    </div>
  </nav>
</article>
{{ end }}