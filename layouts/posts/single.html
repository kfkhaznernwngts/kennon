{{ define "main" }}
<article class="single-page">
  <h1>{{ .Title }}</h1>

  <div class="content">
    {{ .Content }}
  </div>

  <div class="post-meta">
    {{ with .Lastmod }}
      更新日: {{ .Format "2006-01-02" }}
    {{ end }}
  </div>

  <!-- ▼ リンクコピー機能 ▼ -->
  <div class="share-section" style="margin:1.5em 0; text-align:right;">
    <button id="copy-link"
      style="background:#f5f5f5; border:1px solid #ccc; padding:0.4em 0.8em; border-radius:4px; cursor:pointer; font-size:0.9em;">
      リンクをコピー
    </button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btn = document.getElementById("copy-link");
      btn.addEventListener("click", async function() {
        try {
          await navigator.clipboard.writeText(window.location.href);
          btn.textContent = "コピーしました";
          btn.style.background = "#d4edda";
          setTimeout(() => {
            btn.textContent = "リンクをコピー";
            btn.style.background = "#f5f5f5";
          }, 2000);
        } catch (err) {
          btn.textContent = "コピー失敗";
          btn.style.background = "#f8d7da";
        }
      });
    });
  </script>
  <!-- ▲ リンクコピー機能ここまで ▲ -->

  {{ partial "comments.html" . }}

  <nav class="post-pager">
    {{ $sections := site.Params.mainSections | default (slice "posts" "post") }}
    {{ $pages := where site.RegularPages "Section" "in" $sections }}
    {{ $pagesWithDate := slice }}
    {{ range $pages }}
      {{ $pubx := .PublishDate }}
      {{ if $pubx.IsZero }}
        {{ $m := site.Data.publishdates }}
        {{ $k1 := .File.Path }}
        {{ $k2 := printf "content/%s" .File.Path }}
        {{ $k3 := printf "content/%s%s" .File.Dir .File.LogicalName }}
        {{ with or (index $m $k1) (index $m $k2) (index $m $k3) }}
          {{ $pubx = time . }}
        {{ else }}
          {{ $pubx = .Date }}
        {{ end }}
      {{ end }}
      {{ $pagesWithDate = $pagesWithDate | append (dict "page" . "pub" $pubx) }}
    {{ end }}
    {{ $sorted := sort $pagesWithDate "pub" "desc" }}
    {{ $sortedPages := slice }}
    {{ range $sorted }}
      {{ $sortedPages = $sortedPages | append .page }}
    {{ end }}

    {{ $current := . }}
    {{ $index := -1 }}
    {{ range $i, $p := $sortedPages }}
      {{ if eq $p.File.Path $current.File.Path }}
        {{ $index = $i }}
      {{ end }}
    {{ end }}

    <div class="prev-post">
      {{ if ge (sub $index 1) 0 }}
        <a href="{{ (index $sortedPages (sub $index 1)).RelPermalink }}">←</a>
      {{ else }}
        <span class="placeholder"></span>
      {{ end }}
    </div>
    <div class="next-post">
      {{ if lt (add $index 1) (len $sortedPages) }}
        <a href="{{ (index $sortedPages (add $index 1)).RelPermalink }}">→</a>
      {{ else }}
        <span class="placeholder"></span>
      {{ end }}
    </div>
  </nav>
</article>
{{ end }}